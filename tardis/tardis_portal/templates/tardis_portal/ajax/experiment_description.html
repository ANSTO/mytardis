{% load parametertypecheck %}

<script type="text/javascript" charset="utf-8">
	$(".experiment_metadata_toggle").text("[Show Metadata]");	
	$(".experiment_metadata_toggle").next().hide();	
	var loadingHTML = "<img src='/site_media/images/ajax-loader.gif'/>";

	// metadata text / ajax toggle

	// dataset md
	 $(".experiment_metadata_toggle").toggle(function(){
	   $(this).text("[Show Metadata]");
		$(this).next().show();
	
	 },function(){
	   $(this).text("[Hide Metadata]");
		$(this).next().hide();		
	 });
</script>

<div id="experiment_description">

  <p>
    <strong>Authors: </strong><br/>
    {% for author in authors %}
      {{ author.author }}{% if not forloop.last %},{% endif %}
    {% endfor %}
  </p>

  <p>
    <strong>Abstract: </strong>
    <div class="abstract">
      {{ experiment.description|safe }}
    </div>
  </p>

  {% if experiment.handle %}
    <p>
      <strong>Persistent Handle:</strong>
      <a href="{{ handle }}/{{ experiment.handle }}">{{ experiment.handle }}</a><br/>
    </p>
  {% endif %}

  <p>
    <strong>Institution:</strong>
    {{experiment.institution_name}}<br/>
  </p>

  {% if experiment.start_time and experiment.end_time %}
    <p>
      <strong>Date:</strong>
      {{ experiment.start_time|date:"jS F Y H:i" }} - {{ experiment.end_time|date:"jS F Y H:i" }}<br/>
    </p>
  {% endif %}

  <p>
    {% if experiment.experimentparameterset_set.count %}
      <div class="dataset_extrainfo">
	<strong>Experiment Metadata: </strong><a class="experiment_metadata_toggle" href="/ajax/experiment_metadata/{{experiment.id}}/">[Hide]</a>
	
	<div class="dataset_metadata" id="dataset_metadata_{{forloop.counter}}">
	  <ul>
	    {% for parameterset in experiment.experimentparameterset_set.all %}
              <p><strong><em>Schema: {{parameterset.schema}}</em></strong></p>

			<p><a href="{% url tardis.tardis_portal.views.edit_experiment_par parameterset.id %}"
			 class="jqModalExp{{parameterset.id}}">[Edit Parameters]</a></p>

	      {% for parameter in parameterset.experimentparameter_set.all %}
                <li><strong>{{ parameter.name.full_name }}: </strong>
		{% if parameter.name.is_numeric %}
                  {{ parameter.numerical_value }} {{ parameter.name.units }}
                {% else %}
                  {{ parameter.string_value|eparametertypecheck:parameter.id|safe }}
                {% endif %}
		</li>
              {% endfor %}
	      <br/><br/>
		<script type="text/javascript">
		$('#jqmAlertExp{{parameterset.id}}').unbind();
		$('#jqmAlertExp{{parameterset.id}}').jqm({
		  trigger: ".jqModalExp{{parameterset.id}}",
		  ajax: '@href',
		  target: '#jqmAlertContentexperiment{{parameterset.id}}',
		  overlay: 0
		  });
		</script>
		
		<div class="jqmAlert" id="jqmAlertExp{{parameterset.id}}">

			<div class="jqmAlertWindow">
			    <div class="jqmAlertTitle clearfix">
			    <h1>Edit Parameters</h1><a href="#" class="jqmClose"><em>Close</em></a>
			  </div>

			  <div class="jqmAlertContent" id="jqmAlertContentexperiment{{parameterset.id}}">
			  <p>Please wait... <img src="inc/busy.gif" alt="loading" /></p>
			  </div>
			</div>
		</div>		
            {% endfor %}
	  </ul>
	</div>
      </div>
    {% endif %}
  </p>

  <p>
    <strong>Dataset Information:</strong>
    <div>
      <!-- <strong>Dataset Metadata: </strong>	 -->
      <div class="dataset_information">
	<ul>
	  <li><strong>Datasets:</strong> {{experiment.dataset_set.all.count}}</li>
	  <li><strong>Files:</strong> {{datafiles.count}}</li>
	  <li><strong>Size:</strong> {{size|filesizeformat}}</li>
	</ul>
      </div>
    </div>
  </p>

  <p>
    <strong>Experiment Last Updated:</strong>
    {{ experiment.update_time|date:"jS F Y H:i" }}<br/>
  </p>
  <div class="download_entire_experiment">
    {% for p in protocols %}
      <p>
	{% if p %}
	  <strong><a href="/{{p}}/download/experiment/{{experiment.id}}/">Download Entire Experiment ({{p|upper}})</a></strong><br/>
	{% else %}
	  <strong><a href="/download/experiment/{{experiment.id}}/">Download Entire Experiment</a></strong><br/>
	{% endif %}
      </p>
    {% endfor %}
  </div>

  <p align="right">
    <br/>
    {% if owners %}
      <strong>Experiment Administrators </strong><br/>
      {% for owner in owners %}
        {{ owner.username }} {% if owner.email %}(<a href="mailto:{{owner.email}}">{{ owner.email}}</a>{% endif %}){% if not forloop.last %}<br/>{% endif %}
      {% endfor %}
  </p>
{% endif %}

</div>
<div class="jqmAlert" id="jqmAlertExp">

	<div class="jqmAlertWindow">
	    <div class="jqmAlertTitle clearfix">
	    <h1>Edit Parameters</h1><a href="#" class="jqmClose"><em>Close</em></a>
	  </div>

	  <div class="jqmAlertContent" id="jqmAlertContentExp">
	  <p>Please wait... <img src="inc/busy.gif" alt="loading" /></p>
	  </div>
	</div>

</div>